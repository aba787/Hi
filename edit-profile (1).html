<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 20px;
    }
    .profile-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      max-width: 400px;
      margin: 40px auto;
    }
    .profile-card h2 {
      margin-bottom: 10px;
      color: #333;
      text-align: center;
    }
    .profile-info p {
      margin: 8px 0;
      color: #555;
      font-size: 16px;
    }
    .profile-info p span { font-weight: bold; color: #333; }
    .settings {
      margin-top: 20px;
      text-align: center;
    }
    .settings button {
      display: block;
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      background: #008080;
      color: #fff;
      transition: background 0.3s;
    }
    .settings button:hover {
      background: #006666;
    }
    .logout-btn {
      background: #e74c3c;
    }
  </style>
</head>
  <body>

    <!-- âœ… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
    <div id="profile-container" class="profile-card">
      <h2>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ...</h2>
    </div>

    <!-- âœ… Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
    <footer class="bottom-nav">
      <a href="opportunities.html">ğŸ </a>
      <a href="favorites.html">â¤ï¸</a>
      <a href="chat.html" class="active">ğŸ’¬</a>
      <a href="my-requests.html">ğŸ“</a>
      <a href="edit-profile.html">ğŸ‘¤</a>
    </footer>

    <!-- âœ… Ø³ÙƒØ±ÙŠØ¨Øª Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getAuth, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAlMibtDbLAZLMhhJNho5Sih_qBfWxZyXI",
        authDomain: "momaken-45ba9.firebaseapp.com",
        projectId: "momaken-45ba9",
        storageBucket: "momaken-45ba9.appspot.com",
        messagingSenderId: "638133555280",
        appId: "1:638133555280:web:c84bd87c15cabe55d30155"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const container = document.getElementById("profile-container");

      onAuthStateChanged(auth, async (user) => {
        if (!user) return window.location.href = "login.html";

        try {
          // Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
          const profileRef = doc(db, "users", user.uid, "profile", "main");
          const profileSnap = await getDoc(profileRef);
          const profileData = profileSnap.exists() ? profileSnap.data() : {};

          // Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª
          const qualRef = doc(db, "users", user.uid, "qualifications-list", "data");
          const qualSnap = await getDoc(qualRef);
          const qualData = qualSnap.exists() ? qualSnap.data() : {};

          // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          container.innerHTML = `
            <h2>${profileData.name || user.displayName || "Ù„Ù… ÙŠØªÙ… Ø¶Ø¨Ø· Ø§Ù„Ø§Ø³Ù…"}</h2>
            <div class="profile-info">
              <p><span>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯:</span> ${user.email}</p>
              <p><span>ğŸ‚ Ø§Ù„Ø¹Ù…Ø±:</span> ${profileData.age || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
              <p><span>ğŸ“ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</span> ${profileData.region || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
              <p><span>ğŸ·ï¸ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª:</span> ${(profileData.interests || []).join("ØŒ ") || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
              <p><span>ğŸ“„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©:</span>
                ${qualData.cv ? `<a href="${qualData.cv}" target="_blank">Ø¹Ø±Ø¶ / ØªØ­Ù…ÙŠÙ„</a>` : "Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§"}</p>
              <p><span>ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©:</span> ${qualData.education || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©"}</p>
              <p><span>ğŸ’¼ Ù‡Ù„ Ø³Ø¨Ù‚ Ù„Ù‡ Ø§Ù„ØªØ·ÙˆØ¹ØŸ</span> ${qualData.volunteeredBefore === true ? "Ù†Ø¹Ù…" : qualData.volunteeredBefore === false ? "Ù„Ø§" : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
            </div>

            <div class="settings">
              <button id="editBtn">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
              <button id="changePassBtn">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
              <button id="logoutBtn" class="logout-btn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
          `;

          document.getElementById("editBtn").onclick = () => window.location.href = "edit-profile.html";
          document.getElementById("changePassBtn").onclick = () => {
            sendPasswordResetEmail(auth, user.email)
              .then(() => alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ."))
              .catch(err => alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + err.message));
          };
          document.getElementById("logoutBtn").onclick = () => signOut(auth);

        } catch (err) {
          container.innerHTML = "<p>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>";
          console.error("ğŸš¨ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:", err);
        }
      });
    </script>

  </body>